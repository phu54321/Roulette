import bet.betRegions;
import utils.sounds;
import utils.utils;
import utils.rect;
import utils.visualutils;
import roulette.rouletteBoard;

function onPluginStart() {
    sounds.loadSounds();
    randomize();

    // Vision
    RunAIScript("Turn ON Shared Vision for Player 8");
    SetMemory(0x51CE98, SetTo, 2);  // Update vision instantly

    // Init betting locations
    betRegions.initBetRegions();

    // JYD deco
    SetCurrentPlayer(P8);
    RunAIScriptAt(b'JYDg', 'payHere');

    SetCurrentPlayer(P1);

    rouletteBoard.rollRoulette();
}


var t = 0;
function afterTriggerExec() {
    SetInvincibility(Enable, '(any unit)', AllPlayers, 'Anywhere');
    rouletteBoard.rouletteLoop();
    for(var i = 0 ; i < 6 ; i++) {
        SetCurrentPlayer(i);
        MinimapPing("minimapPing");
    }

    if(rouletteBoard.isRouletteFinished()) {
        const rouletteNum = rouletteBoard.getRouletteNumber();
        if(t == 0) {
            for(var i = 0 ; i < 6 ; i++) {
                SetCurrentPlayer(i);
                simpleprint("룰렛 번호는 [", rouletteNum, "] 입니다.");
            }
            betRegions.forBetRegion(rouletteNum, function (rgn: betRegions.BetRegion) {
                visualutils.fillRect(rgn.pos, "Winner", P7);
            });
        }
        t++;
        if(t == 30 * 24) {
            KillUnit("Winner", P7);
            t = 0;
            rouletteBoard.rollRoulette();
        }
    }
}
